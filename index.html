<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>CHONKAGOTCHI ‚Äî Your Chonk is Alive</title>
  <meta name="description" content="A Tamagotchi-style virtual pet game for Chonks ‚Äî the fully onchain PFP collection on Base. Feed, play, and care for your Chonk." />
  <meta name="theme-color" content="#2EA8D5" />
  <meta name="author" content="Flex x Chonks" />
  <meta name="keywords" content="chonks, chonkagotchi, tamagotchi, virtual pet, NFT, Base, onchain, pixel art, game, CC0" />

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
  <link rel="icon" href="favicon.ico" sizes="any" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="manifest" href="site.webmanifest" />

  <!-- Open Graph / Facebook / Discord -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CHONKAGOTCHI ‚Äî Your Chonk is Alive" />
  <meta property="og:description" content="A Tamagotchi for Chonks. Feed it. Play with it. Don't let it die. Fully onchain on Base." />
  <meta property="og:image" content="https://flexasaurusrex.github.io/CHONKAGOTCHI/social.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:url" content="https://flexasaurusrex.github.io/CHONKAGOTCHI/" />
  <meta property="og:site_name" content="CHONKAGOTCHI" />

  <!-- Twitter / X -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="CHONKAGOTCHI ‚Äî Your Chonk is Alive" />
  <meta name="twitter:description" content="A Tamagotchi for Chonks. Feed it. Play with it. Don't let it die." />
  <meta name="twitter:image" content="https://flexasaurusrex.github.io/CHONKAGOTCHI/social.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; -webkit-text-size-adjust: 100%; }
    body { font-family: 'Space Mono', 'Courier New', monospace; background: #fff; color: #000; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
    #root { min-height: 100dvh; max-width: 480px; margin: 0 auto; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: #000; }
    canvas { user-select: none; -webkit-user-select: none; touch-action: none; }
    input:focus { outline: 2px solid #000; outline-offset: -2px; }
    button { font-family: inherit; }
    button:active { transform: scale(0.97); }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
    @keyframes chonkSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes textReveal { 0% { opacity: 0; transform: translateY(16px) scaleY(0); } 60% { opacity: 1; transform: translateY(-4px) scaleY(1.1); } 100% { opacity: 1; transform: translateY(0) scaleY(1); } }
    @keyframes textGlow { 0%,100% { text-shadow: 0 0 0px rgba(46,168,213,0); } 50% { text-shadow: 0 0 12px rgba(46,168,213,.5); } }
    @keyframes dotBounce { 0%,80%,100% { transform: translateY(0); } 40% { transform: translateY(-6px); } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.9.0/ethers.umd.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback, useMemo } = React;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CHONKAGOTCHI v3 ‚Äî Production Build
    //  A gift for Marka ‚Äî from Flex
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    const C = { bg:"#fff", text:"#000", teal:"#2EA8D5", muted:"#999", border:"#e5e5e5", card:"#f5f5f5", ok:"#4CAF50", warn:"#FF9800", bad:"#E74C3C", pink:"#FF4D6A" };
    const CONTRACT = "0x07152bfde079b5319e5308c43fb1dbc9c76cb4f9";
    const RPC = "https://mainnet.base.org";
    const TOTAL_SUPPLY = 83300;

    // ‚îÄ‚îÄ BLOCKCHAIN: Load Chonk SVG by token ID ‚îÄ‚îÄ
    async function fetchChonkImage(tokenId) {
      try {
        const provider = new ethers.JsonRpcProvider(RPC);
        const abi = ["function tokenURI(uint256 tokenId) view returns (string)"];
        const contract = new ethers.Contract(CONTRACT, abi, provider);
        const uri = await contract.tokenURI(tokenId);
        // tokenURI returns base64 JSON: data:application/json;base64,...
        const json = JSON.parse(atob(uri.split(",")[1]));
        return json.image; // This is a data:image/svg+xml;base64,... string
      } catch (e) {
        console.error("Failed to fetch Chonk #" + tokenId, e);
        return null;
      }
    }

    // ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ
    const store = {
      async get(k) { try { const v = localStorage.getItem(k); return v ? {value:v} : null; } catch { return null; } },
      async set(k, v) { try { localStorage.setItem(k, v); return true; } catch { return false; } },
    };

    // ‚îÄ‚îÄ GAME DATA ‚îÄ‚îÄ
    const FOODS = [
      { n:"Pizza", e:"üçï", h:25, ha:10, en:5 },
      { n:"Apple", e:"üçé", h:15, ha:5, en:10 },
      { n:"Cake",  e:"üç∞", h:10, ha:25, en:-5 },
      { n:"Coffee",e:"‚òï", h:0,  ha:5,  en:30 },
      { n:"Salad", e:"ü•ó", h:20, ha:0,  en:15 },
      { n:"Donut", e:"üç©", h:10, ha:20, en:-10 },
      { n:"Ramen", e:"üçú", h:30, ha:15, en:10 },
      { n:"Candy", e:"üç¨", h:5,  ha:30, en:-5 },
      { n:"Juice", e:"üßÉ", h:5,  ha:10, en:20 },
    ];

    const ACHIEVEMENTS = [
      { id:"first_feed", name:"First Meal", desc:"Feed your Chonk for the first time", icon:"üçΩÔ∏è" },
      { id:"feed_10", name:"Foodie", desc:"Feed your Chonk 10 times", icon:"üçï" },
      { id:"feed_50", name:"Master Chef", desc:"Feed your Chonk 50 times", icon:"üë®‚Äçüç≥" },
      { id:"play_10", name:"Playful", desc:"Play 10 times", icon:"üéÆ" },
      { id:"play_50", name:"Game Master", desc:"Play 50 times", icon:"üèÜ" },
      { id:"star_10", name:"Star Collector", desc:"Catch 10+ stars in one game", icon:"‚≠ê" },
      { id:"star_20", name:"Constellation", desc:"Catch 20+ stars in one game", icon:"üåü" },
      { id:"survivor", name:"Survivor", desc:"Recover from critical state", icon:"üí™" },
      { id:"ecstatic", name:"Pure Joy", desc:"Reach Ecstatic mood", icon:"‚ú®" },
      { id:"week_old", name:"One Week", desc:"Chonk survives 7 real days", icon:"üìÖ" },
      { id:"chain_load", name:"Onchain!", desc:"Load a Chonk from the blockchain", icon:"‚õìÔ∏è" },
      { id:"memory", name:"Memory Master", desc:"Score 8+ in Memory Game", icon:"üß†" },
      { id:"pet_frenzy", name:"Pet Frenzy", desc:"Reach a 12x pet combo", icon:"ü§Ø" },
    ];

    // ‚îÄ‚îÄ PET REACTIONS ‚îÄ‚îÄ
    const PET_REACTIONS = {
      ecstatic: {
        words:["YAAAAS!","BEST DAY!","I LOVE U","CHONK BLISS","*SPARKLES*","MAX CHONK","SO HAPPY","LIVING!","PEAK CHONK","IM ASCENDED","TOUCH ME MORE","*vibrating*","LETS GOOOO","*chef kiss*","SEROTONIN!","I CANT EVEN","BLESS","OVERCHONKED","*explodes*","THIS IS IT","TOP CHONK","*squeals*","EUPHORIA","UNLIMITED PWR","MEGA HAPPY","*glowing*","TRANSCENDENT","BEST HUMAN","ONCHAIN JOY","WE MADE IT"],
        emoji:["üíñ","‚ú®","üåü","üí´","üéâ","üíï","‚≠ê","ü•∞","üíó","üåà","ü´†","ü§©","üòç","ü•≥","üíù","ü¶ã","üî•","üíé","üëë","ü´∂"]
      },
      happy: {
        words:["hehe","PURRRR","*happy*","MORE!","yes yes!","chonk!","*wiggles*","ooh!","again!","right there","oh yea","*tail wag*","teehee","*nuzzle*","that's it!","so good","*melts*","don't stop","YES HOOMAN","oooooh","*kicks leg*","nice nice","*rolls over*","das good","keep going","*chirps*","uwu","chonky happy","*bounces*","heehee!"],
        emoji:["üíï","üòä","üíñ","ü•∞","‚ú®","üíó","üòÑ","ü´∂","üíú","‚ù§Ô∏è","üò∏","üê∏","üíö","ü§≠","üòè","üôà","üíì","ü´ß","üé∂","üòã"]
      },
      content: {
        words:["ok ok","hmm nice","*nods*","sure","that's ok","mhm","chonk.","not bad","*blink*","oh hey","acceptable","i guess nice","mmmk","*shrugs*","cool cool","k thx","alright","yep","noted","fine fine","not terrible","*slow blink*","decent","carry on","*chin up*","fair enough","sup","oh. hi.","*nod nod*","mid but ok"],
        emoji:["üôÇ","üíõ","üòå","üëç","üíö","üòè","ü§ô","üíô","üòé","‚úåÔ∏è","ü´°","üò∂‚Äçüå´Ô∏è","ü§∑","üëå","üÜó","üòó","üßò","üíÜ","ü´•","üôÉ"]
      },
      meh: {
        words:["...","meh","whatever","*sigh*","feed me","I guess","ugh","so hungry","bleh","need food","really?","not now","*yawns*","bro. food.","pls feed","im starving","do better","*grumbles*","is that it?","try food","pets dont fill","my tummy","*eye roll*","cool. now feed","priorities pls","less pet more food","bruh","im hangry","*stomach growls*","WHERE IS FOOD"],
        emoji:["üòê","üí§","üòë","ü•±","üò∂","üí≠","üòÆ‚Äçüí®","ü´§","üòí","ü§®","üçï","üò§","üôÑ","üò™","ü´†","ü•¥","üòæ","ü§¶","üíÖ","üßê"]
      },
      sad: {
        words:["*whimper*","please...","so sad","help me","*crying*","why...","lonely","cold...","need love","HELP","*sniff*","abandoned","remember me?","hello??","is anyone there","*shaking*","dont leave","im scared","so alone","where r u","*reaches out*","save me","pls come back","fading...","*weak wave*","i miss u","still here...","barely","*single tear*","getting dark..."],
        emoji:["üò¢","üíß","ü•∫","üòø","üíî","üòû","ü´†","üò£","üò•","üÜò","ü•Ä","üò≠","ü´£","üòü","üò∞","ü™¶","üåßÔ∏è","üòì","üí®","üñ§"]
      },
      critical: {
        words:["!!!","DYING","SOS","*gasp*","FEED ME","HELP!!!","*flailing*","EMERGENCY","CODE RED","MAYDAY","ITS OVER","IM DONE","*flatline*","goodbye world","tell my chonks","avenge me","*dramatic fall*","the light...","going dark","FINAL CHONK","this is the end","*crawling*","one last pet","remember me","*beeping*","DEFCON 1","CRITICAL HIT","system failure","*windows shutdown*","error 404: life"],
        emoji:["üíÄ","üö®","‚ö†Ô∏è","üòµ","üÜò","‚ùå","üíî","üòµ‚Äçüí´","ü´®","‚ò†Ô∏è","‚ö∞Ô∏è","ü™¶","üìâ","üî¥","üí£","üßä","ü´•","üò∂","üï≥Ô∏è","üëª"]
      },
    };
    const PET_COMBOS = [
      {min:1,msg:null}, {min:3,msg:"Combo x3! üî•"}, {min:5,msg:"PET FRENZY! ‚ö°"}, {min:8,msg:"CHONK OVERDRIVE!! üí•"}, {min:12,msg:"LEGENDARY PETS!!! üåü"}, {min:20,msg:"ASCENDED ‚ú®‚ú®‚ú®"}, {min:30,msg:"GODMODE üëëüëëüëë"},
    ];

    // ‚îÄ‚îÄ CHONK HEAD SVG (pixel-perfect from reference) ‚îÄ‚îÄ
    // ‚îÄ‚îÄ ANIMATED LOADING SCREEN ‚îÄ‚îÄ
    const LoadingScreen = () => {
      const [phase, setPhase] = useState(0); // 0=spinning only, 1=title, 2=subtitle, 3=fade ready
      useEffect(()=>{
        const t1 = setTimeout(()=>setPhase(1), 1800);  // title appears
        const t2 = setTimeout(()=>setPhase(2), 3000);  // subtitle appears
        const t3 = setTimeout(()=>setPhase(3), 4200);  // everything settled
        return ()=>{clearTimeout(t1);clearTimeout(t2);clearTimeout(t3);};
      },[]);
      return (
        <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100dvh",background:"#fff",gap:24,overflow:"hidden"}}>
          {/* Spinning Chonk Head ‚Äî smooth continuous rotation */}
          <div style={{animation:"chonkSpin .8s linear infinite",willChange:"transform"}}>
            <img src="android-chrome-192x192.png" alt="Chonk" style={{width:120,height:120,imageRendering:"pixelated"}} />
          </div>
          {/* Title text */}
          <div style={{textAlign:"center",overflow:"hidden"}}>
            <div style={{fontSize:22,fontWeight:700,letterSpacing:4,fontFamily:"'Space Mono',monospace",opacity:phase>=1?1:0,transform:phase>=1?"translateY(0) scaleY(1)":"translateY(16px) scaleY(0)",transition:"all .6s cubic-bezier(.34,1.56,.64,1)"}}>
              CHONKAGOTCHI
            </div>
            <div style={{fontSize:12,fontWeight:700,letterSpacing:3,color:C.teal,marginTop:12,opacity:phase>=2?1:0,transform:phase>=2?"translateY(0)":"translateY(12px)",transition:"all .5s cubic-bezier(.34,1.56,.64,1) .1s",animation:phase>=2?"textGlow 2s ease infinite .5s":"none"}}>
              LET'S F*CKING CHONK!
            </div>
          </div>
          {/* Loading dots */}
          <div style={{display:"flex",gap:6,marginTop:4}}>
            {[0,1,2].map(i=><div key={i} style={{width:6,height:6,background:C.text,animation:`dotBounce .6s ${i*.15}s ease infinite`}}/>)}
          </div>
        </div>
      );
    };

    const clamp = (v,lo=0,hi=100) => Math.max(lo,Math.min(hi,v));

    const getMood = (s) => {
      const a = (s.hunger+s.happiness+s.energy)/3;
      if(a>=85) return {emoji:"‚ú®",label:"Ecstatic!",c:C.ok};
      if(a>=65) return {emoji:"üòä",label:"Happy",c:C.ok};
      if(a>=45) return {emoji:"üôÇ",label:"Content",c:C.teal};
      if(a>=25) return {emoji:"üòê",label:"Meh...",c:C.warn};
      if(a>=10) return {emoji:"üò¢",label:"Sad",c:C.bad};
      return {emoji:"üíÄ",label:"HELP ME!",c:C.bad};
    };

    // ‚îÄ‚îÄ UI COMPONENTS ‚îÄ‚îÄ
    const StatBar = ({label,value,color,icon}) => (
      <div style={{marginBottom:8}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:3,fontSize:12,fontWeight:700}}>
          <span>{icon} {label}</span>
          <span style={{color:value<20?C.bad:C.muted}}>{Math.round(value)}%</span>
        </div>
        <div style={{width:"100%",height:10,background:C.border}}>
          <div style={{width:value+"%",height:"100%",background:value<20?C.bad:color,transition:"width .5s ease"}}/>
        </div>
      </div>
    );

    const Toast = ({message,visible}) => (
      <div style={{position:"fixed",top:16,left:"50%",transform:`translateX(-50%) translateY(${visible?0:-50}px)`,opacity:visible?1:0,transition:"all .4s cubic-bezier(.34,1.56,.64,1)",background:C.text,color:C.bg,padding:"8px 20px",fontSize:13,fontWeight:700,zIndex:1000,pointerEvents:"none",whiteSpace:"nowrap",letterSpacing:.5}}>{message}</div>
    );

    const Btn = ({children,onClick,color=C.text,disabled,small,style:sx}) => {
      const [h,setH] = useState(false);
      return <button onClick={onClick} disabled={disabled} onMouseEnter={()=>setH(true)} onMouseLeave={()=>setH(false)} onTouchStart={()=>setH(true)} onTouchEnd={()=>setH(false)}
        style={{background:h&&!disabled?color:C.bg,border:`2px solid ${color}`,color:h&&!disabled?C.bg:color,padding:small?"8px 10px":"10px 14px",fontSize:small?11:12,fontWeight:700,cursor:disabled?"not-allowed":"pointer",opacity:disabled?.35:1,transition:"all .12s",width:"100%",letterSpacing:.5,fontFamily:"inherit",...sx}}>{children}</button>;
    };

    const FoodItem = ({food,onFeed}) => {
      const [h,setH] = useState(false);
      return <button onClick={onFeed} onMouseEnter={()=>setH(true)} onMouseLeave={()=>setH(false)}
        style={{background:h?C.text:C.bg,border:`2px solid ${C.text}`,color:h?C.bg:C.text,padding:"8px 2px",cursor:"pointer",fontFamily:"inherit",transition:"all .12s",display:"flex",flexDirection:"column",alignItems:"center",gap:1}}>
        <span style={{fontSize:20}}>{food.e}</span><span style={{fontSize:9,fontWeight:700}}>{food.n}</span></button>;
    };

    // ‚îÄ‚îÄ MINI GAME: STAR CATCHER ‚îÄ‚îÄ
    const StarGame = ({onDone,onCancel}) => {
      const ref = useRef(null);
      const gs = useRef({stars:[],score:0,cx:150,t0:Date.now()});
      useEffect(()=>{
        const cv=ref.current; if(!cv) return; const ctx=cv.getContext("2d"); let run=true,raf;
        const loop=()=>{if(!run)return; const g=gs.current,el=(Date.now()-g.t0)/1000,tl=Math.max(0,15-el);
          if(tl<=0){onDone(g.score);return;}
          ctx.clearRect(0,0,300,300); ctx.fillStyle=C.teal; ctx.fillRect(0,0,300,300);
          ctx.strokeStyle="rgba(255,255,255,.06)"; ctx.lineWidth=1;
          for(let i=0;i<300;i+=20){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,300);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(300,i);ctx.stroke();}
          if(Math.random()<.07) g.stars.push({x:15+Math.random()*270,y:-8,sp:1.5+Math.random()*3,sz:8+Math.random()*6});
          g.stars=g.stars.filter(s=>{s.y+=s.sp;if(s.y>255&&s.y<295&&Math.abs(s.x-g.cx)<26){g.score++;return false;}if(s.y>310)return false;
            ctx.fillStyle="#fff";ctx.fillRect(s.x-s.sz/2,s.y-2,s.sz,4);ctx.fillRect(s.x-2,s.y-s.sz/2,4,s.sz);ctx.fillStyle="#FFE066";ctx.fillRect(s.x-2,s.y-2,4,4);return true;});
          ctx.fillStyle="#fff";ctx.fillRect(g.cx-22,268,44,14);ctx.fillStyle=C.text;ctx.fillRect(g.cx-20,270,40,10);
          ctx.fillStyle="#fff";ctx.font="bold 14px 'Space Mono',monospace";ctx.textAlign="left";ctx.fillText("‚òÖ "+g.score,10,24);ctx.textAlign="right";ctx.fillText(Math.ceil(tl)+"s",290,24);
          raf=requestAnimationFrame(loop);};
        const mv=e=>{const r=cv.getBoundingClientRect(),x=(e.clientX||(e.touches&&e.touches[0]&&e.touches[0].clientX))-r.left;gs.current.cx=clamp(x*(300/r.width),22,278);};
        cv.addEventListener("mousemove",mv);cv.addEventListener("touchmove",mv,{passive:true});loop();
        return()=>{run=false;cancelAnimationFrame(raf);cv.removeEventListener("mousemove",mv);cv.removeEventListener("touchmove",mv);};
      },[onDone]);
      return <div style={{textAlign:"center"}}><canvas ref={ref} width={300} height={300} style={{width:"100%",maxWidth:300,border:`2px solid ${C.text}`,cursor:"none",imageRendering:"pixelated",touchAction:"none"}}/><p style={{fontSize:10,color:C.muted,margin:"6px 0"}}>Move to catch stars!</p><button onClick={onCancel} style={{background:"none",border:`1px solid ${C.border}`,color:C.muted,padding:"4px 14px",cursor:"pointer",fontFamily:"inherit",fontSize:10}}>cancel</button></div>;
    };

    // ‚îÄ‚îÄ MINI GAME: MEMORY MATCH ‚îÄ‚îÄ
    const MemoryGame = ({onDone,onCancel}) => {
      const emojis = ["üê∏","üëë","‚≠ê","üéÆ","üçï","üíé","üî•","üåà"];
      const [cards] = useState(()=>{const a=[...emojis,...emojis]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a;});
      const [flipped,setFlipped] = useState([]);
      const [matched,setMatched] = useState(new Set());
      const [moves,setMoves] = useState(0);
      const [score,setScore] = useState(0);

      const handleFlip = (i) => {
        if(flipped.length>=2||flipped.includes(i)||matched.has(i)) return;
        const next = [...flipped,i];
        setFlipped(next);
        if(next.length===2){
          setMoves(m=>m+1);
          if(cards[next[0]]===cards[next[1]]){
            const nm = new Set(matched); nm.add(next[0]); nm.add(next[1]);
            setMatched(nm); setScore(s=>s+1); setFlipped([]);
            if(nm.size===cards.length) setTimeout(()=>onDone(Math.max(0,16-moves)),500);
          } else { setTimeout(()=>setFlipped([]),600); }
        }
      };

      return <div style={{textAlign:"center"}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:8,fontSize:12,fontWeight:700}}><span>Pairs: {score}/8</span><span>Moves: {moves}</span></div>
        <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6}}>
          {cards.map((c,i)=>{const show=flipped.includes(i)||matched.has(i);
            return <button key={i} onClick={()=>handleFlip(i)} style={{aspectRatio:"1",fontSize:22,background:matched.has(i)?C.teal:show?"#e8f4fd":C.card,border:`2px solid ${matched.has(i)?C.teal:C.text}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"inherit",transition:"all .15s"}}>{show?c:"?"}</button>;
          })}
        </div>
        <button onClick={onCancel} style={{marginTop:8,background:"none",border:`1px solid ${C.border}`,color:C.muted,padding:"4px 14px",cursor:"pointer",fontFamily:"inherit",fontSize:10}}>cancel</button>
      </div>;
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MAIN APP
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function App() {
      const [stats, setStats] = useState({hunger:70,happiness:70,energy:70});
      const [chonkId, setChonkId] = useState(null);
      const [chonkImg, setChonkImg] = useState(null);
      const [chonkName, setChonkName] = useState("Chonkie");
      const [nameEdit, setNameEdit] = useState(false);
      const [tab, setTab] = useState("care");
      const [playing, setPlaying] = useState(false);
      const [sleeping, setSleeping] = useState(false);
      const [game, setGame] = useState(null); // "star"|"memory"|null
      const [toast, setToast] = useState({m:"",v:false});
      const [age, setAge] = useState(0); // legacy tick counter for achievements
      const [createdAt, setCreatedAt] = useState(Date.now()); // real birthday
      const [fed, setFed] = useState(0);
      const [played, setPlayed] = useState(0);
      const [hiStar, setHiStar] = useState(0);
      const [hiMem, setHiMem] = useState(0);
      const [achievements, setAchievements] = useState([]);
      const [loaded, setLoaded] = useState(false);
      const [frame, setFrame] = useState(0);
      const [idInput, setIdInput] = useState("");
      const [loadingChonk, setLoadingChonk] = useState(false);
      const [screen, setScreen] = useState("game"); // "game"|"setup"
      const [presetIdx, setPresetIdx] = useState(0);
      const [floats, setFloats] = useState([]); // floating reaction words/emoji
      const [petCombo, setPetCombo] = useState(0);
      const petComboTimer = useRef(null);
      const [petSqueeze, setPetSqueeze] = useState(0); // squeeze animation intensity

      // Preset images from chonks.xyz
      const PRESETS = useMemo(()=>[1,2,3,4,5,6,7].map(i=>`https://www.chonks.xyz/chonks/chonk${i}.png`),[]);

      useEffect(()=>{const i=setInterval(()=>setFrame(f=>f+1),100);return()=>clearInterval(i);},[]);

      const notify = useCallback((m)=>{setToast({m,v:true});setTimeout(()=>setToast(p=>({...p,v:false})),2500);},[]);

      const unlock = useCallback((id)=>{
        setAchievements(prev=>{if(prev.includes(id))return prev; const a=ACHIEVEMENTS.find(x=>x.id===id); if(a) setTimeout(()=>notify(a.icon+" "+a.name+" unlocked!"),300); return [...prev,id];});
      },[notify]);

      // Load save ‚Äî with minimum display time for loading animation
      useEffect(()=>{(async()=>{
        const minDelay = new Promise(r=>setTimeout(r, 5000));
        try{const r=await store.get("cg3");if(r&&r.value){const d=JSON.parse(r.value);
        if(d.stats)setStats(d.stats);if(d.chonkId!=null)setChonkId(d.chonkId);if(d.chonkImg)setChonkImg(d.chonkImg);
        if(d.chonkName)setChonkName(d.chonkName);if(d.age!=null)setAge(d.age);if(d.fed!=null)setFed(d.fed);
        if(d.played!=null)setPlayed(d.played);if(d.hiStar!=null)setHiStar(d.hiStar);if(d.hiMem!=null)setHiMem(d.hiMem);
        if(d.achievements)setAchievements(d.achievements);if(d.presetIdx!=null)setPresetIdx(d.presetIdx);
        if(d.createdAt)setCreatedAt(d.createdAt);
        // Clean up: remove week_old badge if not actually 7 days old
        if(d.achievements && d.createdAt && (Date.now()-d.createdAt)/86400000 < 7) {
          setAchievements(prev => prev.filter(a => a !== "week_old"));
        }
        if(d.lastSave){const h=(Date.now()-d.lastSave)/3600000,dc=Math.min(h*3,40);
          setStats(p=>({hunger:clamp(p.hunger-dc),happiness:clamp(p.happiness-dc*.7),energy:clamp(p.energy+(d.stats?.energy<50?h*5:-dc*.3))}));}
        setScreen("game");
      }}catch(e){}
        await minDelay;
        setLoaded(true);
      })();},[]);

      // Save
      useEffect(()=>{if(!loaded)return;const save=async()=>{try{await store.set("cg3",JSON.stringify({stats,chonkId,chonkImg,chonkName,age,createdAt,fed,played,hiStar,hiMem,achievements,presetIdx,lastSave:Date.now()}));}catch{}};const i=setInterval(save,8000);save();return()=>clearInterval(i);},[stats,chonkId,chonkImg,chonkName,age,createdAt,fed,played,hiStar,hiMem,achievements,presetIdx,loaded]);

      // Decay
      useEffect(()=>{if(!loaded||screen!=="game")return;const i=setInterval(()=>{
        setStats(p=>{
          const n={hunger:clamp(p.hunger-.15),happiness:clamp(p.happiness-.1),energy:sleeping?clamp(p.energy+.5):clamp(p.energy-.08)};
          const avgOld=(p.hunger+p.happiness+p.energy)/3, avgNew=(n.hunger+n.happiness+n.energy)/3;
          if(avgOld<10&&avgNew>=25) unlock("survivor");
          if(avgNew>=85) unlock("ecstatic");
          return n;
        });
        setAge(p=>{const n=p+1;if((Date.now()-createdAt)/86400000>=7)unlock("week_old");return n;});
      },3000);return()=>clearInterval(i);},[sleeping,loaded,screen,unlock]);

      // Achievement checks on fed/played
      useEffect(()=>{if(fed>=1)unlock("first_feed");if(fed>=10)unlock("feed_10");if(fed>=50)unlock("feed_50");},[fed,unlock]);
      useEffect(()=>{if(played>=10)unlock("play_10");if(played>=50)unlock("play_50");},[played,unlock]);

      // Load chonk from chain
      const loadChonk = async(id)=>{
        const n=parseInt(id);if(isNaN(n)||n<1||n>TOTAL_SUPPLY){notify("Enter a valid Chonk ID (1-"+TOTAL_SUPPLY+")");return;}
        setLoadingChonk(true);notify("Loading Chonk #"+n+" from Base...");
        const img=await fetchChonkImage(n);
        if(img){setChonkImg(img);setChonkId(n);setChonkName("Chonk #"+n);unlock("chain_load");notify("Chonk #"+n+" loaded! ‚õìÔ∏è");setScreen("game");}
        else{notify("Couldn't load ‚Äî try a preset instead");}
        setLoadingChonk(false);
      };

      const usePreset=(i)=>{setPresetIdx(i);setChonkImg(PRESETS[i]);setChonkId(null);setChonkName("Chonk "+(i+1));setScreen("game");notify("Let's go! üéâ");};

      // Actions
      const feed=(f)=>{if(sleeping){notify("Sleeping! üí§");return;}setStats(p=>({hunger:clamp(p.hunger+f.h),happiness:clamp(p.happiness+f.ha),energy:clamp(p.energy+f.en)}));setFed(p=>p+1);notify(f.e+" Yum!");};
      const play=()=>{if(sleeping){notify("Wake up first! üí§");return;}if(stats.energy<10){notify("Too tired üò¥");return;}setPlaying(true);setStats(p=>({...p,happiness:clamp(p.happiness+15),energy:clamp(p.energy-10)}));setPlayed(p=>p+1);notify("Wheee! üéâ");setTimeout(()=>setPlaying(false),3000);};
      const doSleep=()=>{setSleeping(p=>!p);setPlaying(false);notify(sleeping?"Good morning! ‚òÄÔ∏è":"Goodnight üåô");};

      const getMoodKey = () => {
        const a=(stats.hunger+stats.happiness+stats.energy)/3;
        if(a>=85)return"ecstatic";if(a>=65)return"happy";if(a>=45)return"content";if(a>=25)return"meh";if(a>=10)return"sad";return"critical";
      };

      const pet=()=>{
        if(sleeping){notify("*snoring* üí§");return;}
        // Combo system
        const newCombo = petCombo + 1;
        setPetCombo(newCombo);
        clearTimeout(petComboTimer.current);
        petComboTimer.current = setTimeout(()=>setPetCombo(0), 1500);
        // Check combo milestone
        const combo = [...PET_COMBOS].reverse().find(c=>newCombo>=c.min);
        if(combo&&combo.msg&&newCombo===combo.min) notify(combo.msg);
        if(newCombo>=12) unlock("pet_frenzy");
        // Happiness boost scales with combo
        const bonus = Math.min(2 + Math.floor(newCombo/3), 8);
        setStats(p=>({...p,happiness:clamp(p.happiness+bonus)}));
        // Squeeze animation
        setPetSqueeze(Math.min(newCombo*2, 15));
        setTimeout(()=>setPetSqueeze(0), 300);
        // Floating reactions
        const mk = getMoodKey();
        const pool = PET_REACTIONS[mk];
        const isEmoji = Math.random() > 0.5;
        const arr = isEmoji ? pool.emoji : pool.words;
        const text = arr[Math.floor(Math.random()*arr.length)];
        const id = Date.now() + Math.random();
        const x = 20 + Math.random() * 60; // % from left
        const size = isEmoji ? 18 + Math.random()*12 : 11 + Math.random()*3;
        setFloats(p=>[...p.slice(-8), {id, text, x, size, isEmoji, t:Date.now()}]);
        // Extra particles on high combos
        if(newCombo >= 5) {
          setTimeout(()=>{
            const t2 = isEmoji ? pool.words[Math.floor(Math.random()*pool.words.length)] : pool.emoji[Math.floor(Math.random()*pool.emoji.length)];
            setFloats(p=>[...p.slice(-8), {id:Date.now()+Math.random(), text:t2, x:10+Math.random()*80, size:isEmoji?12:16, isEmoji:!isEmoji, t:Date.now()}]);
          }, 100);
        }
      };

      // Clean up old floats
      useEffect(()=>{
        if(floats.length===0) return;
        const i = setInterval(()=>setFloats(p=>p.filter(f=>Date.now()-f.t<1800)),500);
        return ()=>clearInterval(i);
      },[floats.length]);

      const onStarDone=(score)=>{setGame(null);setStats(p=>({...p,happiness:clamp(p.happiness+Math.min(score*3,40)),energy:clamp(p.energy-15)}));if(score>hiStar){setHiStar(score);notify("New Star Record: "+score+"! üèÜ");}else notify("Caught "+score+" stars!");if(score>=10)unlock("star_10");if(score>=20)unlock("star_20");setPlayed(p=>p+1);};
      const onMemDone=(score)=>{setGame(null);setStats(p=>({...p,happiness:clamp(p.happiness+Math.min(score*4,40)),energy:clamp(p.energy-10)}));if(score>hiMem){setHiMem(score);notify("New Memory Record! üß†");}else notify("Memory complete!");if(score>=8)unlock("memory");setPlayed(p=>p+1);};

      const mood=getMood(stats);const avg=(stats.hunger+stats.happiness+stats.energy)/3;
      const by=playing?Math.abs(Math.sin(frame*.4))*14:Math.sin(frame*.15)*3;
      const wx=playing?Math.sin(frame*.5)*8:0;
      const wr=playing?Math.sin(frame*.6)*8:Math.sin(frame*.1)*1;
      const sc=1+Math.sin(frame*.12)*.015;
      const currentImg = chonkImg || PRESETS[presetIdx];

      if(!loaded) return <LoadingScreen />;

      // ‚îÄ‚îÄ SETUP SCREEN ‚îÄ‚îÄ
      if(screen==="setup") return (
        <div style={{padding:24,minHeight:"100dvh",display:"flex",flexDirection:"column"}}>
          <div style={{textAlign:"center",marginBottom:24}}>
            <div style={{fontSize:24,fontWeight:700,letterSpacing:4}}>CHONKAGOTCHI</div>
            <div style={{fontSize:10,color:C.muted,letterSpacing:2,marginTop:4}}>CHOOSE YOUR CHONK</div>
          </div>

          {/* Load from chain */}
          <div style={{border:`2px solid ${C.text}`,padding:16,marginBottom:16}}>
            <div style={{fontSize:11,fontWeight:700,letterSpacing:2,marginBottom:10}}>LOAD FROM BLOCKCHAIN</div>
            <div style={{display:"flex",gap:8}}>
              <input value={idInput} onChange={e=>setIdInput(e.target.value.replace(/\D/g,""))} placeholder="Chonk ID (1-83300)"
                style={{flex:1,border:`2px solid ${C.text}`,padding:"10px 12px",fontFamily:"inherit",fontSize:13,fontWeight:700}} />
              <Btn onClick={()=>loadChonk(idInput)} disabled={loadingChonk} style={{width:"auto",padding:"10px 20px",whiteSpace:"nowrap"}}>
                {loadingChonk?"LOADING...":"LOAD ‚õìÔ∏è"}
              </Btn>
            </div>
            <div style={{fontSize:10,color:C.muted,marginTop:6}}>Enter any Chonk token ID to load it directly from Base</div>
          </div>

          {/* Or pick a preset */}
          <div style={{border:`2px solid ${C.border}`,padding:16}}>
            <div style={{fontSize:11,fontWeight:700,letterSpacing:2,marginBottom:10,color:C.muted}}>OR PICK A PRESET</div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8}}>
              {PRESETS.map((url,i)=>(
                <button key={i} onClick={()=>usePreset(i)} style={{aspectRatio:"1",background:C.teal,border:`2px solid ${C.text}`,cursor:"pointer",padding:4,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}}>
                  <img src={url} alt="" style={{width:"90%",height:"90%",objectFit:"contain",imageRendering:"pixelated"}} onError={e=>{e.target.style.display="none";}} />
                </button>
              ))}
            </div>
          </div>
        </div>
      );

      // ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ
      return (
        <div style={{minHeight:"100dvh",display:"flex",flexDirection:"column"}}>
          <Toast message={toast.m} visible={toast.v} />

          {/* HEADER */}
          <div style={{textAlign:"center",padding:"14px 16px 10px",borderBottom:`2px solid ${C.text}`}}>
            <div style={{fontSize:20,fontWeight:700,letterSpacing:4}}>CHONKAGOTCHI</div>
            <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:10,marginTop:6}}>
              {nameEdit?<input autoFocus value={chonkName} onChange={e=>setChonkName(e.target.value.slice(0,16))} onBlur={()=>setNameEdit(false)} onKeyDown={e=>{if(e.key==="Enter")setNameEdit(false);}}
                style={{border:`2px solid ${C.text}`,padding:"4px 10px",fontFamily:"inherit",fontSize:14,fontWeight:700,textAlign:"center",width:150}} />
              :<span onClick={()=>setNameEdit(true)} style={{fontSize:14,fontWeight:700,cursor:"pointer",borderBottom:`1px dashed ${C.muted}`}}>{chonkName}</span>}
              <span style={{fontSize:11,color:mood.c,fontWeight:700,border:`1.5px solid ${mood.c}`,padding:"2px 8px"}}>{mood.emoji} {mood.label}</span>
            </div>
          </div>

          {/* CHONK VIEWPORT */}
          <div onClick={!game?pet:undefined} style={{display:"flex",justifyContent:"center",alignItems:"center",padding:"14px 16px",cursor:game?"default":"pointer",minHeight:240,position:"relative"}}>
            {game==="star"?<StarGame onDone={onStarDone} onCancel={()=>setGame(null)}/>
            :game==="memory"?<MemoryGame onDone={onMemDone} onCancel={()=>setGame(null)}/>
            :(
              <div style={{textAlign:"center",position:"relative"}}>
                {/* Floating reaction words */}
                {floats.map(f=>{
                  const age = (Date.now()-f.t)/1000;
                  const opacity = Math.max(0, 1 - age/1.8);
                  const rise = age * 60;
                  const wobble = Math.sin(age*4+f.x)*8;
                  return <div key={f.id} style={{
                    position:"absolute", left:f.x+"%", bottom:200+rise, transform:`translateX(-50%) translateX(${wobble}px)`,
                    opacity, fontSize:f.size, fontWeight:700, fontFamily:"inherit",
                    color:f.isEmoji?undefined:C.text, pointerEvents:"none", zIndex:20,
                    textShadow:f.isEmoji?"none":"0 1px 3px rgba(255,255,255,.8)",
                    whiteSpace:"nowrap", letterSpacing:f.isEmoji?0:1,
                  }}>{f.text}</div>;
                })}
                {/* Pet combo indicator */}
                {petCombo>=3&&!game&&<div style={{position:"absolute",top:-4,left:"50%",transform:"translateX(-50%)",fontSize:10,fontWeight:700,color:C.pink,letterSpacing:1,zIndex:20,animation:"pulse .5s infinite",whiteSpace:"nowrap"}}>
                  PET COMBO x{petCombo}
                </div>}
                <div style={{width:200,height:200,background:sleeping?"#1a2a3a":C.teal,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden",transition:"background .8s ease"}}>
                  <div style={{position:"absolute",inset:0,opacity:.05,backgroundImage:"linear-gradient(#fff 1px,transparent 1px),linear-gradient(90deg,#fff 1px,transparent 1px)",backgroundSize:"24px 24px"}}/>
                  
                  {/* Floating Z's when sleeping */}
                  {sleeping&&[0,1,2].map(i=>{
                    const cycle = ((frame*0.8+i*40)%120)/120; // 0-1 cycle per Z
                    const zY = 180 - cycle*160; // float upward
                    const zX = 120 + i*25 + Math.sin(cycle*Math.PI*2)*12; // gentle drift
                    const zOp = cycle<0.1?cycle*10 : cycle>0.7?Math.max(0,(1-cycle)/0.3) : 1; // fade in/out
                    const zSize = 14 + i*4 + cycle*6; // grow slightly as they rise
                    return <div key={"z"+i} style={{position:"absolute",left:zX,top:zY,fontSize:zSize,fontWeight:900,color:"#fff",opacity:zOp*0.7,zIndex:8,fontFamily:"inherit",pointerEvents:"none",textShadow:"0 0 8px rgba(255,255,255,.3)"}}>Z</div>;
                  })}
                  
                  {avg<15&&!sleeping&&<div style={{position:"absolute",inset:0,background:`rgba(231,76,60,${.1+Math.sin(frame*.3)*.1})`,zIndex:4}}/>}
                  
                  {/* Chonk ‚Äî rotates 90deg when sleeping (laying down), gentle breathing */}
                  <div style={{
                    transform: sleeping
                      ? `rotate(90deg) scale(${1+Math.sin(frame*.06)*.02})` 
                      : `translateY(${-by}px) translateX(${wx}px) rotate(${wr}deg) scale(${sc}) scaleX(${1+petSqueeze*.01}) scaleY(${1-petSqueeze*.008})`,
                    transition: sleeping ? "transform .8s cubic-bezier(.34,1.56,.64,1)" : (petSqueeze>0?"transform .1s":"transform .3s"),
                    zIndex:6,
                    filter: sleeping ? "brightness(.85) saturate(.7)" : (avg<15?"saturate(.3)":avg<30?"saturate(.7)":"saturate(1)")
                  }}>
                    <img src={currentImg} alt="Chonk" style={{width:150,height:150,imageRendering:"pixelated",objectFit:"contain"}}
                      onError={e=>{e.target.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120"><rect width="100" height="120" fill="#2EA8D5"/><rect x="20" y="5" width="60" height="55" fill="#7EC850"/><rect x="25" y="25" width="50" height="30" fill="#F5D6A8"/><rect x="33" y="32" width="8" height="8" fill="#000"/><rect x="55" y="32" width="8" height="8" fill="#000"/><rect x="40" y="46" width="16" height="4" fill="#000"/><rect x="25" y="60" width="50" height="35" fill="#1a1a1a"/><rect x="30" y="95" width="15" height="20" fill="#2196F3"/><rect x="55" y="95" width="15" height="20" fill="#2196F3"/></svg>');}} />
                  </div>
                  {avg>=80&&!sleeping&&[0,1,2,3].map(i=><div key={i} style={{position:"absolute",left:20+Math.sin(frame*.05+i*1.3)*70+40,top:20+Math.cos(frame*.04+i*1.5)*50+40,width:4,height:4,background:"#FFE066",opacity:.4+Math.sin(frame*.1+i)*.4,zIndex:7}}/>)}
                </div>
                <div style={{fontSize:9,color:C.muted,marginTop:6,letterSpacing:1}}>TAP TO PET ¬∑ <span onClick={e=>{e.stopPropagation();setScreen("setup");}} style={{color:C.teal,cursor:"pointer",fontWeight:700}}>CHANGE CHONK</span></div>
              </div>
            )}
          </div>

          {/* STATS */}
          <div style={{padding:"0 20px 4px"}}>
            <StatBar label="Hunger" value={stats.hunger} color={C.warn} icon="üçî"/>
            <StatBar label="Happiness" value={stats.happiness} color={C.teal} icon="üòä"/>
            <StatBar label="Energy" value={stats.energy} color={C.ok} icon="‚ö°"/>
          </div>

          {/* TABS */}
          <div style={{display:"flex",borderTop:`2px solid ${C.text}`,borderBottom:`2px solid ${C.text}`,flexShrink:0}}>
            {[{id:"care",l:"CARE"},{id:"play",l:"PLAY"},{id:"bag",l:"BADGES"},{id:"stats",l:"INFO"}].map((t,i)=>
              <button key={t.id} onClick={()=>setTab(t.id)} style={{flex:1,padding:"9px 0",textAlign:"center",fontSize:10,fontWeight:700,letterSpacing:1.5,fontFamily:"inherit",color:tab===t.id?C.bg:C.text,background:tab===t.id?C.text:C.bg,border:"none",borderRight:i<3?`1px solid ${C.text}`:"none",cursor:"pointer",transition:"all .12s"}}>{t.l}</button>
            )}
          </div>

          {/* CONTENT */}
          <div style={{padding:"12px 20px 20px",flex:1}}>
            {tab==="care"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>FEED</div>
              <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6}}>
                {FOODS.map((f,i)=><FoodItem key={i} food={f} onFeed={()=>feed(f)} />)}
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:10}}>
                <Btn onClick={doSleep} color={sleeping?C.warn:C.teal} small>{sleeping?"‚òÄÔ∏è WAKE":"üåô SLEEP"}</Btn>
                <Btn onClick={pet} color={C.pink} small>üíï PET</Btn>
              </div>
            </div>}

            {tab==="play"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>GAMES</div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}}>
                <Btn onClick={play} color={C.ok} disabled={sleeping||stats.energy<10} small>üéæ PLAY</Btn>
                <Btn onClick={()=>{if(sleeping){notify("Wake up! üí§");return;}if(stats.energy<15){notify("Tired üò¥");return;}setGame("star");}} color={C.teal} disabled={sleeping||stats.energy<15} small>‚≠ê STARS</Btn>
                <Btn onClick={()=>{if(sleeping){notify("Wake up! üí§");return;}if(stats.energy<10){notify("Tired üò¥");return;}setGame("memory");}} color="#9B59B6" disabled={sleeping||stats.energy<10} small>üß† MEMORY</Btn>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:10}}>
                {hiStar>0&&<div style={{textAlign:"center",fontSize:11,fontWeight:700,color:C.teal,border:`2px solid ${C.teal}`,padding:6}}>‚≠ê Best: {hiStar}</div>}
                {hiMem>0&&<div style={{textAlign:"center",fontSize:11,fontWeight:700,color:"#9B59B6",border:"2px solid #9B59B6",padding:6}}>üß† Best: {hiMem}</div>}
              </div>
            </div>}

            {tab==="bag"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>ACHIEVEMENTS ({achievements.length}/{ACHIEVEMENTS.length})</div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                {ACHIEVEMENTS.map(a=>{const has=achievements.includes(a.id);return <div key={a.id} style={{border:`2px solid ${has?C.text:C.border}`,padding:"10px 8px",opacity:has?1:.4,background:has?C.bg:C.card}}>
                  <div style={{fontSize:18,marginBottom:2}}>{a.icon}</div>
                  <div style={{fontSize:10,fontWeight:700}}>{a.name}</div>
                  <div style={{fontSize:8,color:C.muted,marginTop:2}}>{a.desc}</div>
                </div>;})}
              </div>
            </div>}

            {tab==="stats"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>PROFILE</div>
              <div style={{border:`2px solid ${C.text}`}}>
                {[["Name",chonkName],["Age",Math.floor((Date.now()-createdAt)/86400000)+" days"],["Mood",mood.emoji+" "+mood.label],["Fed",fed+"x"],["Played",played+"x"],["‚≠ê Best",hiStar],["üß† Best",hiMem],["Badges",achievements.length+"/"+ACHIEVEMENTS.length]].map(([l,v],i)=>
                  <div key={l} style={{display:"flex",justifyContent:"space-between",padding:"8px 12px",fontSize:12,fontWeight:700,background:i%2?C.card:C.bg,borderBottom:i<7?`1px solid ${C.border}`:"none"}}>
                    <span style={{color:C.muted}}>{l}</span><span>{v}</span>
                  </div>
                )}
              </div>
              <div style={{marginTop:12,textAlign:"center",border:`2px solid ${C.teal}`,padding:10,fontSize:10,color:C.muted,lineHeight:1.8}}>
                <b style={{color:C.text,fontSize:12}}>CHONKAGOTCHI</b><br/>Built with ‚ù§Ô∏è for Marka<br/><a href="https://chonks.xyz" target="_blank" rel="noopener" style={{color:C.teal,fontWeight:700,textDecoration:"none"}}>chonks.xyz</a> ¬∑ CC0
              </div>
            </div>}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App/>, document.getElementById("root"));
  </script>
</body>
</html>

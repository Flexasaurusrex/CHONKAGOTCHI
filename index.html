<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>CHONKAGOTCHI</title>
  <meta name="description" content="Your Chonk is alive. Take care of it. A Tamagotchi for Chonks." />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üü¢</text></svg>" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; -webkit-text-size-adjust: 100%; }
    body { font-family: 'Space Mono', 'Courier New', monospace; background: #fff; color: #000; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
    #root { min-height: 100dvh; max-width: 480px; margin: 0 auto; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: #000; }
    canvas { user-select: none; -webkit-user-select: none; touch-action: none; }
    input:focus { outline: 2px solid #000; outline-offset: -2px; }
    button { font-family: inherit; }
    button:active { transform: scale(0.97); }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.9.0/ethers.umd.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback, useMemo } = React;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CHONKAGOTCHI v3 ‚Äî Production Build
    //  A gift for Marka ‚Äî from Flex
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    const C = { bg:"#fff", text:"#000", teal:"#2EA8D5", muted:"#999", border:"#e5e5e5", card:"#f5f5f5", ok:"#4CAF50", warn:"#FF9800", bad:"#E74C3C", pink:"#FF4D6A" };
    const CONTRACT = "0x07152bfde079b5319e5308c43fb1dbc9c76cb4f9";
    const RPC = "https://mainnet.base.org";
    const TOTAL_SUPPLY = 83300;

    // ‚îÄ‚îÄ BLOCKCHAIN: Load Chonk SVG by token ID ‚îÄ‚îÄ
    async function fetchChonkImage(tokenId) {
      try {
        const provider = new ethers.JsonRpcProvider(RPC);
        const abi = ["function tokenURI(uint256 tokenId) view returns (string)"];
        const contract = new ethers.Contract(CONTRACT, abi, provider);
        const uri = await contract.tokenURI(tokenId);
        // tokenURI returns base64 JSON: data:application/json;base64,...
        const json = JSON.parse(atob(uri.split(",")[1]));
        return json.image; // This is a data:image/svg+xml;base64,... string
      } catch (e) {
        console.error("Failed to fetch Chonk #" + tokenId, e);
        return null;
      }
    }

    // ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ
    const store = {
      async get(k) { try { const v = localStorage.getItem(k); return v ? {value:v} : null; } catch { return null; } },
      async set(k, v) { try { localStorage.setItem(k, v); return true; } catch { return false; } },
    };

    // ‚îÄ‚îÄ GAME DATA ‚îÄ‚îÄ
    const FOODS = [
      { n:"Pizza", e:"üçï", h:25, ha:10, en:5 },
      { n:"Apple", e:"üçé", h:15, ha:5, en:10 },
      { n:"Cake",  e:"üç∞", h:10, ha:25, en:-5 },
      { n:"Coffee",e:"‚òï", h:0,  ha:5,  en:30 },
      { n:"Salad", e:"ü•ó", h:20, ha:0,  en:15 },
      { n:"Donut", e:"üç©", h:10, ha:20, en:-10 },
      { n:"Ramen", e:"üçú", h:30, ha:15, en:10 },
      { n:"Candy", e:"üç¨", h:5,  ha:30, en:-5 },
      { n:"Juice", e:"üßÉ", h:5,  ha:10, en:20 },
    ];

    const ACHIEVEMENTS = [
      { id:"first_feed", name:"First Meal", desc:"Feed your Chonk for the first time", icon:"üçΩÔ∏è" },
      { id:"feed_10", name:"Foodie", desc:"Feed your Chonk 10 times", icon:"üçï" },
      { id:"feed_50", name:"Master Chef", desc:"Feed your Chonk 50 times", icon:"üë®‚Äçüç≥" },
      { id:"play_10", name:"Playful", desc:"Play 10 times", icon:"üéÆ" },
      { id:"play_50", name:"Game Master", desc:"Play 50 times", icon:"üèÜ" },
      { id:"star_10", name:"Star Collector", desc:"Catch 10+ stars in one game", icon:"‚≠ê" },
      { id:"star_20", name:"Constellation", desc:"Catch 20+ stars in one game", icon:"üåü" },
      { id:"survivor", name:"Survivor", desc:"Recover from critical state", icon:"üí™" },
      { id:"ecstatic", name:"Pure Joy", desc:"Reach Ecstatic mood", icon:"‚ú®" },
      { id:"week_old", name:"One Week", desc:"Chonk survives 7 Chonk days", icon:"üìÖ" },
      { id:"chain_load", name:"Onchain!", desc:"Load a Chonk from the blockchain", icon:"‚õìÔ∏è" },
      { id:"memory", name:"Memory Master", desc:"Score 8+ in Memory Game", icon:"üß†" },
    ];

    const clamp = (v,lo=0,hi=100) => Math.max(lo,Math.min(hi,v));

    const getMood = (s) => {
      const a = (s.hunger+s.happiness+s.energy)/3;
      if(a>=85) return {emoji:"‚ú®",label:"Ecstatic!",c:C.ok};
      if(a>=65) return {emoji:"üòä",label:"Happy",c:C.ok};
      if(a>=45) return {emoji:"üôÇ",label:"Content",c:C.teal};
      if(a>=25) return {emoji:"üòê",label:"Meh...",c:C.warn};
      if(a>=10) return {emoji:"üò¢",label:"Sad",c:C.bad};
      return {emoji:"üíÄ",label:"HELP ME!",c:C.bad};
    };

    // ‚îÄ‚îÄ UI COMPONENTS ‚îÄ‚îÄ
    const StatBar = ({label,value,color,icon}) => (
      <div style={{marginBottom:8}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:3,fontSize:12,fontWeight:700}}>
          <span>{icon} {label}</span>
          <span style={{color:value<20?C.bad:C.muted}}>{Math.round(value)}%</span>
        </div>
        <div style={{width:"100%",height:10,background:C.border}}>
          <div style={{width:value+"%",height:"100%",background:value<20?C.bad:color,transition:"width .5s ease"}}/>
        </div>
      </div>
    );

    const Toast = ({message,visible}) => (
      <div style={{position:"fixed",top:16,left:"50%",transform:`translateX(-50%) translateY(${visible?0:-50}px)`,opacity:visible?1:0,transition:"all .4s cubic-bezier(.34,1.56,.64,1)",background:C.text,color:C.bg,padding:"8px 20px",fontSize:13,fontWeight:700,zIndex:1000,pointerEvents:"none",whiteSpace:"nowrap",letterSpacing:.5}}>{message}</div>
    );

    const Btn = ({children,onClick,color=C.text,disabled,small,style:sx}) => {
      const [h,setH] = useState(false);
      return <button onClick={onClick} disabled={disabled} onMouseEnter={()=>setH(true)} onMouseLeave={()=>setH(false)} onTouchStart={()=>setH(true)} onTouchEnd={()=>setH(false)}
        style={{background:h&&!disabled?color:C.bg,border:`2px solid ${color}`,color:h&&!disabled?C.bg:color,padding:small?"8px 10px":"10px 14px",fontSize:small?11:12,fontWeight:700,cursor:disabled?"not-allowed":"pointer",opacity:disabled?.35:1,transition:"all .12s",width:"100%",letterSpacing:.5,fontFamily:"inherit",...sx}}>{children}</button>;
    };

    // ‚îÄ‚îÄ MINI GAME: STAR CATCHER ‚îÄ‚îÄ
    const StarGame = ({onDone,onCancel}) => {
      const ref = useRef(null);
      const gs = useRef({stars:[],score:0,cx:150,t0:Date.now()});
      useEffect(()=>{
        const cv=ref.current; if(!cv) return; const ctx=cv.getContext("2d"); let run=true,raf;
        const loop=()=>{if(!run)return; const g=gs.current,el=(Date.now()-g.t0)/1000,tl=Math.max(0,15-el);
          if(tl<=0){onDone(g.score);return;}
          ctx.clearRect(0,0,300,300); ctx.fillStyle=C.teal; ctx.fillRect(0,0,300,300);
          ctx.strokeStyle="rgba(255,255,255,.06)"; ctx.lineWidth=1;
          for(let i=0;i<300;i+=20){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,300);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(300,i);ctx.stroke();}
          if(Math.random()<.07) g.stars.push({x:15+Math.random()*270,y:-8,sp:1.5+Math.random()*3,sz:8+Math.random()*6});
          g.stars=g.stars.filter(s=>{s.y+=s.sp;if(s.y>255&&s.y<295&&Math.abs(s.x-g.cx)<26){g.score++;return false;}if(s.y>310)return false;
            ctx.fillStyle="#fff";ctx.fillRect(s.x-s.sz/2,s.y-2,s.sz,4);ctx.fillRect(s.x-2,s.y-s.sz/2,4,s.sz);ctx.fillStyle="#FFE066";ctx.fillRect(s.x-2,s.y-2,4,4);return true;});
          ctx.fillStyle="#fff";ctx.fillRect(g.cx-22,268,44,14);ctx.fillStyle=C.text;ctx.fillRect(g.cx-20,270,40,10);
          ctx.fillStyle="#fff";ctx.font="bold 14px 'Space Mono',monospace";ctx.textAlign="left";ctx.fillText("‚òÖ "+g.score,10,24);ctx.textAlign="right";ctx.fillText(Math.ceil(tl)+"s",290,24);
          raf=requestAnimationFrame(loop);};
        const mv=e=>{const r=cv.getBoundingClientRect(),x=(e.clientX||(e.touches&&e.touches[0]&&e.touches[0].clientX))-r.left;gs.current.cx=clamp(x*(300/r.width),22,278);};
        cv.addEventListener("mousemove",mv);cv.addEventListener("touchmove",mv,{passive:true});loop();
        return()=>{run=false;cancelAnimationFrame(raf);cv.removeEventListener("mousemove",mv);cv.removeEventListener("touchmove",mv);};
      },[onDone]);
      return <div style={{textAlign:"center"}}><canvas ref={ref} width={300} height={300} style={{width:"100%",maxWidth:300,border:`2px solid ${C.text}`,cursor:"none",imageRendering:"pixelated",touchAction:"none"}}/><p style={{fontSize:10,color:C.muted,margin:"6px 0"}}>Move to catch stars!</p><button onClick={onCancel} style={{background:"none",border:`1px solid ${C.border}`,color:C.muted,padding:"4px 14px",cursor:"pointer",fontFamily:"inherit",fontSize:10}}>cancel</button></div>;
    };

    // ‚îÄ‚îÄ MINI GAME: MEMORY MATCH ‚îÄ‚îÄ
    const MemoryGame = ({onDone,onCancel}) => {
      const emojis = ["üê∏","üëë","‚≠ê","üéÆ","üçï","üíé","üî•","üåà"];
      const [cards] = useState(()=>{const a=[...emojis,...emojis]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a;});
      const [flipped,setFlipped] = useState([]);
      const [matched,setMatched] = useState(new Set());
      const [moves,setMoves] = useState(0);
      const [score,setScore] = useState(0);

      const handleFlip = (i) => {
        if(flipped.length>=2||flipped.includes(i)||matched.has(i)) return;
        const next = [...flipped,i];
        setFlipped(next);
        if(next.length===2){
          setMoves(m=>m+1);
          if(cards[next[0]]===cards[next[1]]){
            const nm = new Set(matched); nm.add(next[0]); nm.add(next[1]);
            setMatched(nm); setScore(s=>s+1); setFlipped([]);
            if(nm.size===cards.length) setTimeout(()=>onDone(Math.max(0,16-moves)),500);
          } else { setTimeout(()=>setFlipped([]),600); }
        }
      };

      return <div style={{textAlign:"center"}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:8,fontSize:12,fontWeight:700}}><span>Pairs: {score}/8</span><span>Moves: {moves}</span></div>
        <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6}}>
          {cards.map((c,i)=>{const show=flipped.includes(i)||matched.has(i);
            return <button key={i} onClick={()=>handleFlip(i)} style={{aspectRatio:"1",fontSize:22,background:matched.has(i)?C.teal:show?"#e8f4fd":C.card,border:`2px solid ${matched.has(i)?C.teal:C.text}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"inherit",transition:"all .15s"}}>{show?c:"?"}</button>;
          })}
        </div>
        <button onClick={onCancel} style={{marginTop:8,background:"none",border:`1px solid ${C.border}`,color:C.muted,padding:"4px 14px",cursor:"pointer",fontFamily:"inherit",fontSize:10}}>cancel</button>
      </div>;
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MAIN APP
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function App() {
      const [stats, setStats] = useState({hunger:70,happiness:70,energy:70});
      const [chonkId, setChonkId] = useState(null);
      const [chonkImg, setChonkImg] = useState(null);
      const [chonkName, setChonkName] = useState("Chonkie");
      const [nameEdit, setNameEdit] = useState(false);
      const [tab, setTab] = useState("care");
      const [playing, setPlaying] = useState(false);
      const [sleeping, setSleeping] = useState(false);
      const [game, setGame] = useState(null); // "star"|"memory"|null
      const [toast, setToast] = useState({m:"",v:false});
      const [age, setAge] = useState(0);
      const [fed, setFed] = useState(0);
      const [played, setPlayed] = useState(0);
      const [hiStar, setHiStar] = useState(0);
      const [hiMem, setHiMem] = useState(0);
      const [achievements, setAchievements] = useState([]);
      const [loaded, setLoaded] = useState(false);
      const [frame, setFrame] = useState(0);
      const [idInput, setIdInput] = useState("");
      const [loadingChonk, setLoadingChonk] = useState(false);
      const [screen, setScreen] = useState("game"); // "game"|"setup"
      const [presetIdx, setPresetIdx] = useState(0);

      // Preset images from chonks.xyz
      const PRESETS = useMemo(()=>[1,2,3,4,5,6,7].map(i=>`https://www.chonks.xyz/chonks/chonk${i}.png`),[]);

      useEffect(()=>{const i=setInterval(()=>setFrame(f=>f+1),100);return()=>clearInterval(i);},[]);

      const notify = useCallback((m)=>{setToast({m,v:true});setTimeout(()=>setToast(p=>({...p,v:false})),2500);},[]);

      const unlock = useCallback((id)=>{
        setAchievements(prev=>{if(prev.includes(id))return prev; const a=ACHIEVEMENTS.find(x=>x.id===id); if(a) setTimeout(()=>notify(a.icon+" "+a.name+" unlocked!"),300); return [...prev,id];});
      },[notify]);

      // Load save
      useEffect(()=>{(async()=>{try{const r=await store.get("cg3");if(r&&r.value){const d=JSON.parse(r.value);
        if(d.stats)setStats(d.stats);if(d.chonkId!=null)setChonkId(d.chonkId);if(d.chonkImg)setChonkImg(d.chonkImg);
        if(d.chonkName)setChonkName(d.chonkName);if(d.age!=null)setAge(d.age);if(d.fed!=null)setFed(d.fed);
        if(d.played!=null)setPlayed(d.played);if(d.hiStar!=null)setHiStar(d.hiStar);if(d.hiMem!=null)setHiMem(d.hiMem);
        if(d.achievements)setAchievements(d.achievements);if(d.presetIdx!=null)setPresetIdx(d.presetIdx);
        if(d.lastSave){const h=(Date.now()-d.lastSave)/3600000,dc=Math.min(h*3,40);
          setStats(p=>({hunger:clamp(p.hunger-dc),happiness:clamp(p.happiness-dc*.7),energy:clamp(p.energy+(d.stats?.energy<50?h*5:-dc*.3))}));}
        setScreen("game");
      }}catch(e){}setLoaded(true);})();},[]);

      // Save
      useEffect(()=>{if(!loaded)return;const save=async()=>{try{await store.set("cg3",JSON.stringify({stats,chonkId,chonkImg,chonkName,age,fed,played,hiStar,hiMem,achievements,presetIdx,lastSave:Date.now()}));}catch{}};const i=setInterval(save,8000);save();return()=>clearInterval(i);},[stats,chonkId,chonkImg,chonkName,age,fed,played,hiStar,hiMem,achievements,presetIdx,loaded]);

      // Decay
      useEffect(()=>{if(!loaded||screen!=="game")return;const i=setInterval(()=>{
        setStats(p=>{
          const n={hunger:clamp(p.hunger-.15),happiness:clamp(p.happiness-.1),energy:sleeping?clamp(p.energy+.5):clamp(p.energy-.08)};
          const avgOld=(p.hunger+p.happiness+p.energy)/3, avgNew=(n.hunger+n.happiness+n.energy)/3;
          if(avgOld<10&&avgNew>=25) unlock("survivor");
          if(avgNew>=85) unlock("ecstatic");
          return n;
        });
        setAge(p=>{const n=p+1;if(Math.floor(n/20)>=7)unlock("week_old");return n;});
      },3000);return()=>clearInterval(i);},[sleeping,loaded,screen,unlock]);

      // Achievement checks on fed/played
      useEffect(()=>{if(fed>=1)unlock("first_feed");if(fed>=10)unlock("feed_10");if(fed>=50)unlock("feed_50");},[fed,unlock]);
      useEffect(()=>{if(played>=10)unlock("play_10");if(played>=50)unlock("play_50");},[played,unlock]);

      // Load chonk from chain
      const loadChonk = async(id)=>{
        const n=parseInt(id);if(isNaN(n)||n<1||n>TOTAL_SUPPLY){notify("Enter a valid Chonk ID (1-"+TOTAL_SUPPLY+")");return;}
        setLoadingChonk(true);notify("Loading Chonk #"+n+" from Base...");
        const img=await fetchChonkImage(n);
        if(img){setChonkImg(img);setChonkId(n);setChonkName("Chonk #"+n);unlock("chain_load");notify("Chonk #"+n+" loaded! ‚õìÔ∏è");setScreen("game");}
        else{notify("Couldn't load ‚Äî try a preset instead");}
        setLoadingChonk(false);
      };

      const usePreset=(i)=>{setPresetIdx(i);setChonkImg(PRESETS[i]);setChonkId(null);setChonkName("Chonk "+(i+1));setScreen("game");notify("Let's go! üéâ");};

      // Actions
      const feed=(f)=>{if(sleeping){notify("Sleeping! üí§");return;}setStats(p=>({hunger:clamp(p.hunger+f.h),happiness:clamp(p.happiness+f.ha),energy:clamp(p.energy+f.en)}));setFed(p=>p+1);notify(f.e+" Yum!");};
      const play=()=>{if(sleeping){notify("Wake up first! üí§");return;}if(stats.energy<10){notify("Too tired üò¥");return;}setPlaying(true);setStats(p=>({...p,happiness:clamp(p.happiness+15),energy:clamp(p.energy-10)}));setPlayed(p=>p+1);notify("Wheee! üéâ");setTimeout(()=>setPlaying(false),3000);};
      const doSleep=()=>{setSleeping(p=>!p);setPlaying(false);notify(sleeping?"Good morning! ‚òÄÔ∏è":"Goodnight üåô");};
      const pet=()=>{if(sleeping){notify("*snoring* üí§");return;}setStats(p=>({...p,happiness:clamp(p.happiness+8)}));notify("*purrs* üíï");};

      const onStarDone=(score)=>{setGame(null);setStats(p=>({...p,happiness:clamp(p.happiness+Math.min(score*3,40)),energy:clamp(p.energy-15)}));if(score>hiStar){setHiStar(score);notify("New Star Record: "+score+"! üèÜ");}else notify("Caught "+score+" stars!");if(score>=10)unlock("star_10");if(score>=20)unlock("star_20");setPlayed(p=>p+1);};
      const onMemDone=(score)=>{setGame(null);setStats(p=>({...p,happiness:clamp(p.happiness+Math.min(score*4,40)),energy:clamp(p.energy-10)}));if(score>hiMem){setHiMem(score);notify("New Memory Record! üß†");}else notify("Memory complete!");if(score>=8)unlock("memory");setPlayed(p=>p+1);};

      const mood=getMood(stats);const avg=(stats.hunger+stats.happiness+stats.energy)/3;
      const by=playing?Math.abs(Math.sin(frame*.4))*14:Math.sin(frame*.15)*3;
      const wx=playing?Math.sin(frame*.5)*8:0;
      const wr=playing?Math.sin(frame*.6)*8:Math.sin(frame*.1)*1;
      const sc=1+Math.sin(frame*.12)*.015;
      const currentImg = chonkImg || PRESETS[presetIdx];

      if(!loaded) return <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100dvh"}}><div style={{fontSize:24,fontWeight:700,letterSpacing:4}}>CHONKAGOTCHI</div><div style={{color:C.muted,fontSize:12,marginTop:8,animation:"pulse 1.5s infinite"}}>Loading...</div></div>;

      // ‚îÄ‚îÄ SETUP SCREEN ‚îÄ‚îÄ
      if(screen==="setup") return (
        <div style={{padding:24,minHeight:"100dvh",display:"flex",flexDirection:"column"}}>
          <div style={{textAlign:"center",marginBottom:24}}>
            <div style={{fontSize:24,fontWeight:700,letterSpacing:4}}>CHONKAGOTCHI</div>
            <div style={{fontSize:10,color:C.muted,letterSpacing:2,marginTop:4}}>CHOOSE YOUR CHONK</div>
          </div>

          {/* Load from chain */}
          <div style={{border:`2px solid ${C.text}`,padding:16,marginBottom:16}}>
            <div style={{fontSize:11,fontWeight:700,letterSpacing:2,marginBottom:10}}>LOAD FROM BLOCKCHAIN</div>
            <div style={{display:"flex",gap:8}}>
              <input value={idInput} onChange={e=>setIdInput(e.target.value.replace(/\D/g,""))} placeholder="Chonk ID (1-83300)"
                style={{flex:1,border:`2px solid ${C.text}`,padding:"10px 12px",fontFamily:"inherit",fontSize:13,fontWeight:700}} />
              <Btn onClick={()=>loadChonk(idInput)} disabled={loadingChonk} style={{width:"auto",padding:"10px 20px",whiteSpace:"nowrap"}}>
                {loadingChonk?"LOADING...":"LOAD ‚õìÔ∏è"}
              </Btn>
            </div>
            <div style={{fontSize:10,color:C.muted,marginTop:6}}>Enter any Chonk token ID to load it directly from Base</div>
          </div>

          {/* Or pick a preset */}
          <div style={{border:`2px solid ${C.border}`,padding:16}}>
            <div style={{fontSize:11,fontWeight:700,letterSpacing:2,marginBottom:10,color:C.muted}}>OR PICK A PRESET</div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8}}>
              {PRESETS.map((url,i)=>(
                <button key={i} onClick={()=>usePreset(i)} style={{aspectRatio:"1",background:C.teal,border:`2px solid ${C.text}`,cursor:"pointer",padding:4,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}}>
                  <img src={url} alt="" style={{width:"90%",height:"90%",objectFit:"contain",imageRendering:"pixelated"}} onError={e=>{e.target.style.display="none";}} />
                </button>
              ))}
            </div>
          </div>
        </div>
      );

      // ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ
      return (
        <div style={{minHeight:"100dvh",display:"flex",flexDirection:"column"}}>
          <Toast message={toast.m} visible={toast.v} />

          {/* HEADER */}
          <div style={{textAlign:"center",padding:"14px 16px 10px",borderBottom:`2px solid ${C.text}`}}>
            <div style={{fontSize:20,fontWeight:700,letterSpacing:4}}>CHONKAGOTCHI</div>
            <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:10,marginTop:6}}>
              {nameEdit?<input autoFocus value={chonkName} onChange={e=>setChonkName(e.target.value.slice(0,16))} onBlur={()=>setNameEdit(false)} onKeyDown={e=>{if(e.key==="Enter")setNameEdit(false);}}
                style={{border:`2px solid ${C.text}`,padding:"4px 10px",fontFamily:"inherit",fontSize:14,fontWeight:700,textAlign:"center",width:150}} />
              :<span onClick={()=>setNameEdit(true)} style={{fontSize:14,fontWeight:700,cursor:"pointer",borderBottom:`1px dashed ${C.muted}`}}>{chonkName}</span>}
              <span style={{fontSize:11,color:mood.c,fontWeight:700,border:`1.5px solid ${mood.c}`,padding:"2px 8px"}}>{mood.emoji} {mood.label}</span>
            </div>
          </div>

          {/* CHONK VIEWPORT */}
          <div onClick={!game?pet:undefined} style={{display:"flex",justifyContent:"center",alignItems:"center",padding:"14px 16px",cursor:game?"default":"pointer",minHeight:240,position:"relative"}}>
            {game==="star"?<StarGame onDone={onStarDone} onCancel={()=>setGame(null)}/>
            :game==="memory"?<MemoryGame onDone={onMemDone} onCancel={()=>setGame(null)}/>
            :(
              <div style={{textAlign:"center"}}>
                <div style={{width:200,height:200,background:C.teal,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",position:"relative",overflow:"hidden"}}>
                  <div style={{position:"absolute",inset:0,opacity:.05,backgroundImage:"linear-gradient(#fff 1px,transparent 1px),linear-gradient(90deg,#fff 1px,transparent 1px)",backgroundSize:"24px 24px"}}/>
                  {sleeping&&<div style={{position:"absolute",inset:0,background:"rgba(0,0,0,.35)",zIndex:5,display:"flex",alignItems:"center",justifyContent:"center"}}><span style={{fontSize:32,opacity:.5+Math.sin(frame*.08)*.3}}>üí§</span></div>}
                  {avg<15&&!sleeping&&<div style={{position:"absolute",inset:0,background:`rgba(231,76,60,${.1+Math.sin(frame*.3)*.1})`,zIndex:4}}/>}
                  <div style={{transform:`translateY(${-by}px) translateX(${wx}px) rotate(${wr}deg) scale(${sc})`,transition:playing?"none":"transform .3s",zIndex:6,filter:avg<15?"saturate(.3)":avg<30?"saturate(.7)":"saturate(1)"}}>
                    <img src={currentImg} alt="Chonk" style={{width:150,height:150,imageRendering:"pixelated",objectFit:"contain"}}
                      onError={e=>{e.target.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120"><rect width="100" height="120" fill="#2EA8D5"/><rect x="20" y="5" width="60" height="55" fill="#7EC850"/><rect x="25" y="25" width="50" height="30" fill="#F5D6A8"/><rect x="33" y="32" width="8" height="8" fill="#000"/><rect x="55" y="32" width="8" height="8" fill="#000"/><rect x="40" y="46" width="16" height="4" fill="#000"/><rect x="25" y="60" width="50" height="35" fill="#1a1a1a"/><rect x="30" y="95" width="15" height="20" fill="#2196F3"/><rect x="55" y="95" width="15" height="20" fill="#2196F3"/></svg>');}} />
                  </div>
                  {avg>=80&&!sleeping&&[0,1,2,3].map(i=><div key={i} style={{position:"absolute",left:20+Math.sin(frame*.05+i*1.3)*70+40,top:20+Math.cos(frame*.04+i*1.5)*50+40,width:4,height:4,background:"#FFE066",opacity:.4+Math.sin(frame*.1+i)*.4,zIndex:7}}/>)}
                </div>
                <div style={{fontSize:9,color:C.muted,marginTop:6,letterSpacing:1}}>TAP TO PET ¬∑ <span onClick={e=>{e.stopPropagation();setScreen("setup");}} style={{color:C.teal,cursor:"pointer",fontWeight:700}}>CHANGE CHONK</span></div>
              </div>
            )}
          </div>

          {/* STATS */}
          <div style={{padding:"0 20px 4px"}}>
            <StatBar label="Hunger" value={stats.hunger} color={C.warn} icon="üçî"/>
            <StatBar label="Happiness" value={stats.happiness} color={C.teal} icon="üòä"/>
            <StatBar label="Energy" value={stats.energy} color={C.ok} icon="‚ö°"/>
          </div>

          {/* TABS */}
          <div style={{display:"flex",borderTop:`2px solid ${C.text}`,borderBottom:`2px solid ${C.text}`,flexShrink:0}}>
            {[{id:"care",l:"CARE"},{id:"play",l:"PLAY"},{id:"bag",l:"BADGES"},{id:"stats",l:"INFO"}].map((t,i)=>
              <button key={t.id} onClick={()=>setTab(t.id)} style={{flex:1,padding:"9px 0",textAlign:"center",fontSize:10,fontWeight:700,letterSpacing:1.5,fontFamily:"inherit",color:tab===t.id?C.bg:C.text,background:tab===t.id?C.text:C.bg,border:"none",borderRight:i<3?`1px solid ${C.text}`:"none",cursor:"pointer",transition:"all .12s"}}>{t.l}</button>
            )}
          </div>

          {/* CONTENT */}
          <div style={{padding:"12px 20px 20px",flex:1}}>
            {tab==="care"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>FEED</div>
              <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6}}>
                {FOODS.map((f,i)=>{const [h,setH]=useState(false);return <button key={i} onClick={()=>feed(f)} onMouseEnter={()=>setH(true)} onMouseLeave={()=>setH(false)}
                  style={{background:h?C.text:C.bg,border:`2px solid ${C.text}`,color:h?C.bg:C.text,padding:"8px 2px",cursor:"pointer",fontFamily:"inherit",transition:"all .12s",display:"flex",flexDirection:"column",alignItems:"center",gap:1}}>
                  <span style={{fontSize:20}}>{f.e}</span><span style={{fontSize:9,fontWeight:700}}>{f.n}</span></button>;})}
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:10}}>
                <Btn onClick={doSleep} color={sleeping?C.warn:C.teal} small>{sleeping?"‚òÄÔ∏è WAKE":"üåô SLEEP"}</Btn>
                <Btn onClick={pet} color={C.pink} small>üíï PET</Btn>
              </div>
            </div>}

            {tab==="play"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>GAMES</div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}}>
                <Btn onClick={play} color={C.ok} disabled={sleeping||stats.energy<10} small>üéæ PLAY</Btn>
                <Btn onClick={()=>{if(sleeping){notify("Wake up! üí§");return;}if(stats.energy<15){notify("Tired üò¥");return;}setGame("star");}} color={C.teal} disabled={sleeping||stats.energy<15} small>‚≠ê STARS</Btn>
                <Btn onClick={()=>{if(sleeping){notify("Wake up! üí§");return;}if(stats.energy<10){notify("Tired üò¥");return;}setGame("memory");}} color="#9B59B6" disabled={sleeping||stats.energy<10} small>üß† MEMORY</Btn>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:10}}>
                {hiStar>0&&<div style={{textAlign:"center",fontSize:11,fontWeight:700,color:C.teal,border:`2px solid ${C.teal}`,padding:6}}>‚≠ê Best: {hiStar}</div>}
                {hiMem>0&&<div style={{textAlign:"center",fontSize:11,fontWeight:700,color:"#9B59B6",border:"2px solid #9B59B6",padding:6}}>üß† Best: {hiMem}</div>}
              </div>
            </div>}

            {tab==="bag"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>ACHIEVEMENTS ({achievements.length}/{ACHIEVEMENTS.length})</div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
                {ACHIEVEMENTS.map(a=>{const has=achievements.includes(a.id);return <div key={a.id} style={{border:`2px solid ${has?C.text:C.border}`,padding:"10px 8px",opacity:has?1:.4,background:has?C.bg:C.card}}>
                  <div style={{fontSize:18,marginBottom:2}}>{a.icon}</div>
                  <div style={{fontSize:10,fontWeight:700}}>{a.name}</div>
                  <div style={{fontSize:8,color:C.muted,marginTop:2}}>{a.desc}</div>
                </div>;})}
              </div>
            </div>}

            {tab==="stats"&&<div>
              <div style={{fontSize:10,fontWeight:700,color:C.muted,marginBottom:10,letterSpacing:2}}>PROFILE</div>
              <div style={{border:`2px solid ${C.text}`}}>
                {[["Name",chonkName],["Age",Math.floor(age/20)+" days"],["Mood",mood.emoji+" "+mood.label],["Fed",fed+"x"],["Played",played+"x"],["‚≠ê Best",hiStar],["üß† Best",hiMem],["Badges",achievements.length+"/"+ACHIEVEMENTS.length]].map(([l,v],i)=>
                  <div key={l} style={{display:"flex",justifyContent:"space-between",padding:"8px 12px",fontSize:12,fontWeight:700,background:i%2?C.card:C.bg,borderBottom:i<7?`1px solid ${C.border}`:"none"}}>
                    <span style={{color:C.muted}}>{l}</span><span>{v}</span>
                  </div>
                )}
              </div>
              <div style={{marginTop:12,textAlign:"center",border:`2px solid ${C.teal}`,padding:10,fontSize:10,color:C.muted,lineHeight:1.8}}>
                <b style={{color:C.text,fontSize:12}}>CHONKAGOTCHI</b><br/>Built with ‚ù§Ô∏è for Marka<br/><a href="https://chonks.xyz" target="_blank" rel="noopener" style={{color:C.teal,fontWeight:700,textDecoration:"none"}}>chonks.xyz</a> ¬∑ CC0
              </div>
            </div>}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App/>, document.getElementById("root"));
  </script>
</body>
</html>
